# 请假流程设计器使用指南

## 概述

请假流程设计器是一个基于 BPMN 2.0 的可视化工作流设计工具，用于创建和管理完善的请假审批流程。

## 功能特性

### 🎯 完善的请假流程

- **多种请假类型**: 年假、病假、事假、调休、婚假、产假、丧假
- **智能路由**: 根据请假类型和天数自动选择审批路径
- **并行处理**: 人事和财务确认并行进行，提高效率
- **完整通知**: 自动发送审批结果通知

### 🔧 技术特性

- **BPMN 2.0 标准**: 使用标准 BPMN 元素和 Camunda 扩展
- **可视化设计**: 直观的拖拽式流程设计界面
- **属性面板**: 详细的元素属性配置
- **实时预览**: 所见即所得的流程预览

## 快速开始

### 1. 访问设计器

在浏览器中打开请假流程设计页面，您将看到：

- 左侧：BPMN 设计画布
- 右侧：属性配置面板
- 顶部：工具栏和调试面板

### 2. 查看现有流程

页面加载后会自动显示完善的请假审批流程，包括：

- 开始事件和结束事件
- 用户任务（审批节点）
- 服务任务（自动处理）
- 网关（条件判断和并行处理）
- 连线（流程路径）

### 3. 编辑流程

- **选择元素**: 点击画布上的任何元素
- **修改属性**: 在右侧属性面板中修改元素属性
- **添加元素**: 从左侧工具栏拖拽新元素到画布
- **连接元素**: 拖拽元素上的连接点创建连线

## 流程组件说明

### 用户任务 (User Task)

- **填写请假申请**: 员工提交请假申请
- **直接主管审批**: 处理年假、调休、事假
- **HR经理审批**: 处理病假申请
- **部门经理审批**: 处理超过3天的申请
- **总经理审批**: 处理特殊假期
- **人事确认**: 更新考勤系统
- **财务确认**: 处理薪资相关事项

### 服务任务 (Service Task)

- **表单验证**: 自动验证申请数据
- **通知申请人**: 发送审批结果通知
- **更新考勤系统**: 自动更新考勤记录
- **拒绝通知**: 发送拒绝通知

### 网关 (Gateway)

- **请假类型判断**: 根据请假类型分发
- **请假天数判断**: 根据天数决定是否需要额外审批
- **并行审批**: 并行处理多个确认任务
- **合并确认**: 等待所有确认完成
- **审批结果**: 判断审批通过或拒绝

## 配置说明

### 任务分配

每个用户任务都有 `camunda:assignee` 属性，用于指定任务执行人：

- `employee`: 员工
- `directManager`: 直接主管
- `hrManager`: HR经理
- `departmentManager`: 部门经理
- `generalManager`: 总经理
- `hr`: 人事专员
- `finance`: 财务专员

### 服务任务配置

服务任务通过 `camunda:class` 属性指定实现类：

- `FormValidationService`: 表单验证服务
- `NotificationService`: 通知服务
- `AttendanceService`: 考勤系统服务
- `RejectionNotificationService`: 拒绝通知服务

## 业务规则

### 请假类型路由

1. **年假/调休** → 直接主管审批
2. **病假** → HR经理审批
3. **事假** → 直接主管审批
4. **特殊假期** → 总经理审批

### 审批层级

- **≤3天**: 直接主管 → 人事确认
- **>3天**: 直接主管 → 部门经理 → 人事确认
- **特殊假期**: 总经理 → 人事确认

### 并行处理

人事确认和财务确认并行进行，所有确认完成后才能继续后续流程。

## 调试功能

### 翻译调试面板

页面右上角提供翻译调试功能：

- 显示未翻译的元素
- 实时跟踪翻译调用
- 支持自定义翻译

### 属性面板

右侧属性面板提供：

- 元素基本信息
- Camunda 扩展属性
- 文档说明
- 验证规则

## 最佳实践

### 1. 流程设计

- 保持流程逻辑清晰
- 合理使用并行网关提高效率
- 为每个任务添加清晰的文档说明

### 2. 任务分配

- 明确角色职责
- 避免任务分配冲突
- 考虑任务委派机制

### 3. 异常处理

- 提供完整的拒绝流程
- 处理系统异常情况
- 支持流程回退

### 4. 性能优化

- 合理使用并行处理
- 避免过度复杂的条件判断
- 优化流程路径

## 常见问题

### Q: 如何添加新的请假类型？

A: 在请假类型判断网关中添加新的条件分支，并创建对应的审批任务。

### Q: 如何修改审批层级？

A: 调整请假天数判断网关的条件，或添加新的审批任务。

### Q: 如何集成其他系统？

A: 创建新的服务任务，实现对应的服务类，并在流程中引用。

### Q: 如何自定义通知方式？

A: 修改通知服务实现类，支持邮件、短信、微信等多种通知方式。

## 技术支持

如需技术支持或有任何问题，请参考：

- [完善请假流程设计文档](./ENHANCED_LEAVE_PROCESS_DESIGN.md)
- [BPMN 2.0 规范文档](https://www.omg.org/spec/BPMN/2.0/)
- [Camunda 官方文档](https://docs.camunda.org/)

---

**注意**: 本设计器遵循 BPMN 2.0 标准和 Camunda 工作流引擎规范，确保流程的可执行性和可维护性。
