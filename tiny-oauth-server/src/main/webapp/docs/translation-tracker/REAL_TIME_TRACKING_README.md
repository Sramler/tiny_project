# å®æ—¶ç¿»è¯‘è°ƒç”¨è¿½è¸ªç³»ç»Ÿ

## æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†è·¨é¡µé¢çš„å®æ—¶ç¿»è¯‘è°ƒç”¨è¿½è¸ªåŠŸèƒ½ï¼Œå…è®¸ç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨é¡µé¢å®æ—¶æ¥æ”¶å·¥ä½œæµè®¾è®¡å™¨é¡µé¢çš„ç¿»è¯‘è°ƒç”¨æ•°æ®ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ”„ å®æ—¶é€šä¿¡

- åŸºäº localStorage çš„è·¨é¡µé¢é€šä¿¡æœºåˆ¶
- è‡ªåŠ¨æ£€æµ‹é¡µé¢è¿æ¥çŠ¶æ€
- å®æ—¶æ›´æ–°ç¿»è¯‘è°ƒç”¨ç»Ÿè®¡

### ğŸ“Š æ•°æ®è¿½è¸ª

- è®°å½•ç¿»è¯‘è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯ï¼ˆé”®ã€æ¥æºã€ç»„ä»¶ã€æ—¶é—´æˆ³ã€ç»“æœï¼‰
- æ”¯æŒæŒ‰æ¥æºã€ç»„ä»¶ã€ç¿»è¯‘é”®è¿›è¡Œç­›é€‰
- æä¾›è¯¦ç»†çš„è°ƒç”¨å†å²å’Œåˆ†ææŠ¥å‘Š

### ğŸ¯ æ™ºèƒ½æ£€æµ‹

- è‡ªåŠ¨æ£€æµ‹è°ƒç”¨æ¥æºï¼ˆpaletteã€contextPadã€propertiesPanelç­‰ï¼‰
- è‡ªåŠ¨è¯†åˆ«è°ƒç”¨ç»„ä»¶ï¼ˆPaletteã€ContextPadã€PropertiesPanelç­‰ï¼‰
- æ”¯æŒè°ƒç”¨æ ˆä¿¡æ¯è®°å½•

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨å®æ—¶è¿½è¸ª

#### æ–¹æ³•ä¸€ï¼šåŒæ—¶æ‰“å¼€ä¸¤ä¸ªé¡µé¢

1. æ‰“å¼€å·¥ä½œæµè®¾è®¡å™¨é¡µé¢ï¼š`http://localhost:5173/workflowDesign`
2. æ‰“å¼€ç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨é¡µé¢ï¼š`http://localhost:5175/translationCallTracker`
3. åœ¨å·¥ä½œæµè®¾è®¡å™¨ä¸­è¿›è¡Œæ“ä½œï¼Œç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨ä¼šè‡ªåŠ¨æ¥æ”¶æ•°æ®

#### æ–¹æ³•äºŒï¼šä½¿ç”¨æµ‹è¯•é¡µé¢

1. æ‰“å¼€ç¿»è¯‘æµ‹è¯•é¡µé¢ï¼š`http://localhost:5175/translationTest`
2. ç‚¹å‡»"æ¨¡æ‹Ÿå·¥ä½œæµè®¾è®¡å™¨è°ƒç”¨"æŒ‰é’®
3. è§‚å¯Ÿç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨çš„å®æ—¶æ›´æ–°

### 2. æŸ¥çœ‹å®æ—¶æ•°æ®

åœ¨ç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥ï¼š

- **ç³»ç»ŸçŠ¶æ€é¢æ¿**ï¼šæŸ¥çœ‹ç¿»è¯‘ç³»ç»ŸåŠ è½½çŠ¶æ€å’Œå®æ—¶è¿æ¥çŠ¶æ€
- **ç»Ÿè®¡æ¦‚è§ˆ**ï¼šæŸ¥çœ‹æ€»è°ƒç”¨æ¬¡æ•°ã€å”¯ä¸€ç¿»è¯‘é”®ã€æ¥æºæ•°é‡ç­‰
- **è¯¦ç»†ç»Ÿè®¡**ï¼šæŒ‰æ¥æºå’Œç»„ä»¶æŸ¥çœ‹è°ƒç”¨åˆ†å¸ƒ
- **è°ƒç”¨å†å²**ï¼šæŸ¥çœ‹è¯¦ç»†çš„ç¿»è¯‘è°ƒç”¨è®°å½•

### 3. ç­›é€‰å’Œåˆ†æ

- **æŒ‰æ¥æºç­›é€‰**ï¼šé€‰æ‹©ç‰¹å®šçš„è°ƒç”¨æ¥æºï¼ˆå¦‚ paletteã€contextPadï¼‰
- **æŒ‰ç»„ä»¶ç­›é€‰**ï¼šé€‰æ‹©ç‰¹å®šçš„ç»„ä»¶ï¼ˆå¦‚ Paletteã€ContextPadï¼‰
- **æŒ‰ç¿»è¯‘é”®æœç´¢**ï¼šæœç´¢ç‰¹å®šçš„ç¿»è¯‘é”®
- **å¯¼å‡ºæŠ¥å‘Š**ï¼šå¯¼å‡ºè¯¦ç»†çš„è°ƒç”¨åˆ†ææŠ¥å‘Š

## æŠ€æœ¯å®ç°

### è·¨é¡µé¢é€šä¿¡æœºåˆ¶

```typescript
// å‘é€å®æ—¶æ•°æ®
function broadcastTranslationCall(call: TranslationCall): void {
  const eventData = {
    type: 'translation_call',
    pageId: currentPageId,
    key: call.key,
    source: call.source,
    component: call.component,
    timestamp: call.timestamp,
    result: call.result,
  }

  localStorage.setItem(REAL_TIME_EVENT_KEY, JSON.stringify(eventData))
}

// æ¥æ”¶å®æ—¶æ•°æ®
window.addEventListener('storage', (event) => {
  if (event.key === REAL_TIME_EVENT_KEY && event.newValue) {
    const data = JSON.parse(event.newValue)
    if (data.pageId !== currentPageId && data.type === 'translation_call') {
      // å¤„ç†æ¥æ”¶åˆ°çš„ç¿»è¯‘è°ƒç”¨æ•°æ®
      handleTranslationCall(data)
    }
  }
})
```

### æ•°æ®å­˜å‚¨

ç¿»è¯‘è°ƒç”¨æ•°æ®å­˜å‚¨åœ¨ä»¥ä¸‹ä½ç½®ï¼š

1. **å†…å­˜ç¼“å­˜**ï¼š`translationCallHistory` æ•°ç»„
2. **æœ¬åœ°å­˜å‚¨**ï¼š`localStorage` ä¸­çš„ `bpmn_translation_call_history`
3. **é¡µé¢é€šä¿¡**ï¼š`localStorage` ä¸­çš„ `bpmn_translation_realtime_event`

### é¡µé¢æ ‡è¯†

æ¯ä¸ªé¡µé¢éƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼š

```typescript
const currentPageId = Math.random().toString(36).substr(2, 9)
localStorage.setItem('bpmn_translation_page_id', currentPageId)
```

## é…ç½®é€‰é¡¹

### ç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨é…ç½®

```typescript
// è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰
const autoRefreshInterval = 5000

// æœ€å¤§å†å²è®°å½•æ•°é‡
const maxCallHistory = 1000

// é¡µé¢å¤§å°
const pageSize = 20
```

### å·¥ä½œæµè®¾è®¡å™¨é…ç½®

```typescript
// è°ƒè¯•é¢æ¿æ˜¾ç¤º
initDebug({
  enabled: true,
  showPanel: true,
  showButton: true,
  autoRefresh: false,
  refreshInterval: 5000,
})

// åˆå§‹åŒ–è·¨é¡µé¢é€šä¿¡
initRealTimeCommunication()
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®æ—¶è¿æ¥æœªå»ºç«‹**

   - ç¡®ä¿å·¥ä½œæµè®¾è®¡å™¨é¡µé¢å·²æ‰“å¼€
   - æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ localStorage
   - ç¡®è®¤ä¸¤ä¸ªé¡µé¢åœ¨åŒä¸€åŸŸåä¸‹

2. **æ•°æ®ä¸åŒæ­¥**

   - åˆ·æ–°ç¿»è¯‘è°ƒç”¨è¿½è¸ªå™¨é¡µé¢
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
   - ç¡®è®¤ç¿»è¯‘ç³»ç»Ÿå·²æ­£ç¡®åŠ è½½

3. **æ€§èƒ½é—®é¢˜**
   - å‡å°‘è‡ªåŠ¨åˆ·æ–°é¢‘ç‡
   - æ¸…ç†å†å²è®°å½•
   - é™åˆ¶æœ€å¤§è®°å½•æ•°é‡

### è°ƒè¯•æ–¹æ³•

1. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**

   ```javascript
   // å¯ç”¨è°ƒè¯•æ—¥å¿—
   setDebugLogs(true)
   ```

2. **æ£€æŸ¥è¿æ¥çŠ¶æ€**

   ```javascript
   // æŸ¥çœ‹é¡µé¢ID
   console.log(localStorage.getItem('bpmn_translation_page_id'))

   // æŸ¥çœ‹å†å²è®°å½•
   console.log(getTranslationCallHistory())
   ```

3. **æ‰‹åŠ¨è§¦å‘åŒæ­¥**

   ```javascript
   // åˆ·æ–°ç»Ÿè®¡æ•°æ®
   refreshStats()

   // åŒæ­¥å·¥ä½œæµè®¾è®¡å™¨æ•°æ®
   syncWorkflowDesignerData()
   ```

## API å‚è€ƒ

### æ ¸å¿ƒå‡½æ•°

```typescript
// åˆå§‹åŒ–è·¨é¡µé¢é€šä¿¡
initRealTimeCommunication(): void

// æ¸…ç†è·¨é¡µé¢é€šä¿¡
cleanupRealTimeCommunication(): void

// è·å–ç¿»è¯‘è°ƒç”¨å†å²
getTranslationCallHistory(): TranslationCall[]

// è·å–ç¿»è¯‘è°ƒç”¨ç»Ÿè®¡
getTranslationCallStats(): TranslationCallStats

// æ¸…é™¤è°ƒç”¨å†å²
clearCallHistory(): void

// å¯¼å‡ºè°ƒç”¨æŠ¥å‘Š
exportCallReport(): void
```

### æ•°æ®ç±»å‹

```typescript
interface TranslationCall {
  key: string
  source: string
  component: string
  timestamp: number
  stack?: string
  result: string
}

interface TranslationCallStats {
  totalCalls: number
  callsBySource: Record<string, number>
  callsByComponent: Record<string, number>
  recentCalls: TranslationCall[]
  uniqueKeys: string[]
}
```

## æœ€ä½³å®è·µ

1. **æ€§èƒ½ä¼˜åŒ–**

   - å®šæœŸæ¸…ç†å†å²è®°å½•
   - ä½¿ç”¨é€‚å½“çš„åˆ·æ–°é—´éš”
   - é¿å…åœ¨çŸ­æ—¶é—´å†…äº§ç”Ÿå¤§é‡è°ƒç”¨

2. **æ•°æ®ç®¡ç†**

   - å®šæœŸå¯¼å‡ºé‡è¦æ•°æ®
   - ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
   - åŠæ—¶å¤„ç†å¼‚å¸¸æ•°æ®

3. **ç”¨æˆ·ä½“éªŒ**
   - æä¾›æ¸…æ™°çš„çŠ¶æ€æŒ‡ç¤º
   - æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°
   - æä¾›ä¸°å¯Œçš„ç­›é€‰å’Œåˆ†æåŠŸèƒ½

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-03-21)

- å®ç°è·¨é¡µé¢å®æ—¶é€šä¿¡æœºåˆ¶
- æ·»åŠ ç¿»è¯‘è°ƒç”¨è¿½è¸ªåŠŸèƒ½
- æ”¯æŒå®æ—¶æ•°æ®åŒæ­¥å’ŒçŠ¶æ€ç›‘æ§
- æä¾›å®Œæ•´çš„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’åŠŸèƒ½
